{
  "hash": "6ca6ba6c6be6bb90bb9811f63d190d58",
  "result": {
    "markdown": "---\ntitle: \"Exploring discrepancy encoding with ITS (Part 4)\"\nauthor: \"Bram Goh\"\ndate: \"2023-04-21\"\ncategories: [code]\nimage: \"ALredlines.png\"\n---\n\n\n# One-hot encoding words in ITS and applying discrepancy encoding\n\nWe identified a difficulty with combining ITS and MINERVA-AL: in ITS, sentence vectors are formed by adding word vectors together, and two or more word vectors can have non-zero elements in the same vector columns (e.g. A = \\[1, 1, 0, 1\\], B = \\[1, 0, 1, 1\\]. Thus, values in the sentence vectors can exceed the -1 to 1 range. In contrast, in MINERVA-AL, compound stimuli is represented by adding basic components with non-overlapping vector columns (e.g. A = \\[1, 1, 0, 0\\], B = \\[0, 0, 1, 1\\]). Also, MINERVA-AL always normalizes the echo to the -1 to 1 range before computing the probe-echo discrepancy. Hence, in last week's exercise, the probes (sentence vectors) had values way larger in magnitude than the echoes, resulting in the discrepancy vectors being strange.\n\nOne way to mitigate this issue is to normalize the sentence vectors so that they also fall within the -1 to 1 range. Another method is to apply something similar to one-hot encoding to ensure the word vectors don't have overlapping vector columns, so sentences always remain within the -1 to 1 range.\n\nThe goal of this exercise is to repeat last week's exercise while apply one-hot encoding-style representations for word vectors.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n✔ ggplot2 3.3.6     ✔ purrr   1.0.1\n✔ tibble  3.2.0     ✔ dplyr   1.1.0\n✔ tidyr   1.3.0     ✔ stringr 1.5.0\n✔ readr   2.1.2     ✔ forcats 0.5.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(RsemanticLibrarian)\nlibrary(data.table)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'data.table'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:purrr':\n\n    transpose\n```\n:::\n\n```{.r .cell-code}\nlibrary(tm)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: NLP\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'NLP'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:ggplot2':\n\n    annotate\n```\n:::\n\n```{.r .cell-code}\nn_words <- 130\nband_width <- 10\n\n# Setup of word-sentence co-occurence matrix\nband_matrix <- Matrix::bandSparse(n = n_words,k=0:(band_width-1))\nband_matrix <- as.matrix(band_matrix)*1\n\n# ITS setup (each word appears in the same number of sentences)\ndictionary_words <- 1:n_words\n\nsentence_ids <- list()\nfor(i in 1:ncol(band_matrix)){\n  sentence_ids[[i]] <- which(band_matrix[,i] == 1)\n}\nsentence_ids <- sentence_ids[11:119]\n\nwords_to_plot <- c(11:110)\n\n# Function to generate echoes for a list of words (from Matt)\nsubset_semantic_vectors <- function(strings,dictionary,e_vectors,sentence_memory,tau=3){\n  \n  word_meaning <- matrix(0, ncol = dim(e_vectors)[2],\n                         nrow = length(strings))\n  \n  for (i in 1:length(strings)) {\n    word_id <- which(dictionary %in% strings[i])\n    probe <- e_vectors[word_id, ]\n    activations <- cosine_x_to_m(probe, sentence_memory)\n    echo <- colSums(as.numeric(activations ^ tau) * (sentence_memory))\n    word_meaning[i, ] <- echo\n  }\n  \n  row.names(word_meaning) <- strings\n  return(word_meaning)\n}\n\n# Function to create environment vectors with non-overlapping columns (modified from RsemanticLibrarian::sl_create_riv)\nno_overlap_riv <- function(dimensions, no_of_words, sparsity = 10){\n  if(sparsity %% 2 != 0) stop(\"sparsity must be even integer\")\n  temp_matrix <- matrix(0,ncol=dimensions,nrow=no_of_words)\n  for(i in 1:no_of_words){\n    temp_matrix[i, (i*10):(i*10+sparsity-1)] <- sample(c(rep(1, sparsity/2), rep(-1, sparsity/2)))\n  }\n  return(temp_matrix)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ground truths to compare to: first- and second- order similarity\nfirst_order_cosines <- lsa::cosine(t(band_matrix[words_to_plot,]))\nsecond_order_cosines <- lsa::cosine(t(first_order_cosines))\n```\n:::\n\n\n## Comparing learning over 15 representations of sentences\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmax_sent_freq <- 15\nn_of_sim <- 10\n```\n:::\n\n\n### No discrepancy encoding (L = 1.0, i.e. point of comparison)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR2_first_1.0 <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\nR2_second_1.0 <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\n\nfor(i in 1:n_of_sim){\nenvironment_sub <- no_overlap_riv(10000, length(dictionary_words))\n\nprior_memory <- t(replicate(4, sample(c(-1,0,1), ncol(environment_sub), replace = TRUE)))\nits_memory <- prior_memory\nR2_first <- numeric(length = max_sent_freq)\nR2_second <- numeric(length = max_sent_freq)\n\n  for(j in 1:max_sent_freq){\n    sentence_ids_reordered <- sample(sentence_ids)\n    its_memory_chunk <- matrix(0, ncol=dim(environment_sub)[2],nrow=length(sentence_ids))\n    for(k in 1:length(sentence_ids_reordered)) {\n    its_memory_chunk[k, ] <- colSums(environment_sub[sentence_ids_reordered[[k]],])\n    }\n    its_memory <- rbind(its_memory, its_memory_chunk)\n  semantic_vectors <- subset_semantic_vectors(words_to_plot,\n                                                dictionary_words,\n                                                environment_sub,\n                                                its_memory,\n                                                tau=3)\n  cosines_ITS_1.0 <- lsa::cosine(t(semantic_vectors))\n  R2_first[j] <- cor(c(cosines_ITS_1.0),c(first_order_cosines))^2\n  R2_second[j] <- cor(c(cosines_ITS_1.0),c(second_order_cosines))^2\n  }\nR2_first_1.0[i, ] <- R2_first\nR2_second_1.0[i, ] <- R2_second\n}\n```\n:::\n\n\n### No discrepancy encoding (L = .3)\n\nFirst, let's visualize how the semantic vector similarities change as sentences are presented with higher frequency.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncosines_list_0.3 <- list()\n\nenvironment_sub <- no_overlap_riv(10000, length(dictionary_words))\nprior_memory_test <- t(replicate(4, sample(c(-1,0,1), ncol(environment_sub), replace = TRUE)))\nits_memory <- prior_memory_test\n\nfor(j in 1:max_sent_freq){\n    sentence_ids_reordered <- sample(sentence_ids)\n    its_memory_chunk <- matrix(0, ncol=dim(environment_sub)[2],nrow=length(sentence_ids))\n    for(k in 1:length(sentence_ids_reordered)) {\n    its_memory_chunk[k, ] <- colSums(environment_sub[sentence_ids_reordered[[k]],]) * sample(c(0,1), ncol(environment_sub), replace = TRUE, prob = c(1 - .3, .3))\n    }\n    its_memory <- rbind(its_memory, its_memory_chunk)\n  semantic_vectors <- subset_semantic_vectors(words_to_plot,\n                                                dictionary_words,\n                                                environment_sub,\n                                                its_memory,\n                                                tau=3)\n  cosines_list_0.3[[j]] <- lsa::cosine(t(semantic_vectors))\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(i in 1:length(cosines_list_0.3)){\n  corrplot::corrplot(cosines_list_0.3[[i]],\n                   method=\"circle\",\n                   order=\"original\",\n                   tl.col=\"black\",\n                   tl.cex=.4,\n                   title=\"\",\n                   cl.cex=.5,\n                   outline=FALSE,\n                   addgrid.col=NA)\n}\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-6.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-8.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-9.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-10.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-11.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-12.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-13.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-14.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-15.png){width=672}\n:::\n:::\n\n\nNow, for the actual simulations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR2_first_0.3 <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\nR2_second_0.3 <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\n\nfor(i in 1:n_of_sim){\nenvironment_sub <- no_overlap_riv(10000, length(dictionary_words))\n\nR2_first <- numeric(length = max_sent_freq)\nR2_second <- numeric(length = max_sent_freq)\nprior_memory <- t(replicate(4, sample(c(-1,0,1), ncol(environment_sub), replace = TRUE)))\nits_memory_0.3 <- prior_memory\n\n  for(j in 1:max_sent_freq){\n    sentence_ids_reordered <- sample(sentence_ids)\n    its_memory_chunk <- matrix(0, ncol=dim(environment_sub)[2],nrow=length(sentence_ids))\n    for(k in 1:length(sentence_ids_reordered)) {\n    its_memory_chunk[k, ] <- colSums(environment_sub[sentence_ids_reordered[[k]],]) * sample(c(0,1), ncol(environment_sub), replace = TRUE, prob = c(1 - .3, .3))\n    }\n    its_memory_0.3 <- rbind(its_memory_0.3, its_memory_chunk)\n  semantic_vectors <- subset_semantic_vectors(words_to_plot,\n                                                dictionary_words,\n                                                environment_sub,\n                                                its_memory_0.3,\n                                                tau=3)\n  cosines_ITS_0.3 <- lsa::cosine(t(semantic_vectors))\n  R2_first[j] <- cor(c(cosines_ITS_0.3),c(first_order_cosines))^2\n  R2_second[j] <- cor(c(cosines_ITS_0.3),c(second_order_cosines))^2\n  }\nR2_first_0.3[i, ] <- R2_first\nR2_second_0.3[i, ] <- R2_second\n}\n```\n:::\n\n\n### No discrepancy encoding (L = .5)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR2_first_0.5 <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\nR2_second_0.5 <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\n\nfor(i in 1:n_of_sim){\nenvironment_sub <- no_overlap_riv(10000, length(dictionary_words))\n\nR2_first <- numeric(length = max_sent_freq)\nR2_second <- numeric(length = max_sent_freq)\nprior_memory <- t(replicate(4, sample(c(-1,0,1), ncol(environment_sub), replace = TRUE)))\nits_memory_0.5 <- prior_memory\n\n  for(j in 1:max_sent_freq){\n    sentence_ids_reordered <- sample(sentence_ids)\n    its_memory_chunk <- matrix(0, ncol=dim(environment_sub)[2],nrow=length(sentence_ids))\n    for(k in 1:length(sentence_ids_reordered)) {\n    its_memory_chunk[k, ] <- colSums(environment_sub[sentence_ids_reordered[[k]],]) * sample(c(0,1), ncol(environment_sub), replace = TRUE, prob = c(1 - .5, .5))\n    }\n    its_memory_0.5 <- rbind(its_memory_0.5, its_memory_chunk)\n  semantic_vectors <- subset_semantic_vectors(words_to_plot,\n                                                dictionary_words,\n                                                environment_sub,\n                                                its_memory_0.5,\n                                                tau=3)\n  cosines_ITS_0.5 <- lsa::cosine(t(semantic_vectors))\n  R2_first[j] <- cor(c(cosines_ITS_0.5),c(first_order_cosines))^2\n  R2_second[j] <- cor(c(cosines_ITS_0.5),c(second_order_cosines))^2\n  }\nR2_first_0.5[i, ] <- R2_first\nR2_second_0.5[i, ] <- R2_second\n}\n```\n:::\n\n\n### No discrepancy encoding (L = .7)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR2_first_0.7 <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\nR2_second_0.7 <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\n\nfor(i in 1:n_of_sim){\nenvironment_sub <- no_overlap_riv(10000, length(dictionary_words))\n\nR2_first <- numeric(length = max_sent_freq)\nR2_second <- numeric(length = max_sent_freq)\nprior_memory <- t(replicate(4, sample(c(-1,0,1), ncol(environment_sub), replace = TRUE)))\nits_memory_0.7 <- prior_memory\n\n  for(j in 1:max_sent_freq){\n    sentence_ids_reordered <- sample(sentence_ids)\n    its_memory_chunk <- matrix(0, ncol=dim(environment_sub)[2],nrow=length(sentence_ids))\n    for(k in 1:length(sentence_ids_reordered)) {\n    its_memory_chunk[k, ] <- colSums(environment_sub[sentence_ids_reordered[[k]],]) * sample(c(0,1), ncol(environment_sub), replace = TRUE, prob = c(1 - .7, .7))\n    }\n    its_memory_0.7 <- rbind(its_memory_0.7, its_memory_chunk)\n  semantic_vectors <- subset_semantic_vectors(words_to_plot,\n                                                dictionary_words,\n                                                environment_sub,\n                                                its_memory_0.7,\n                                                tau=3)\n  cosines_ITS_0.7 <- lsa::cosine(t(semantic_vectors))\n  R2_first[j] <- cor(c(cosines_ITS_0.7),c(first_order_cosines))^2\n  R2_second[j] <- cor(c(cosines_ITS_0.7),c(second_order_cosines))^2\n  }\nR2_first_0.7[i, ] <- R2_first\nR2_second_0.7[i, ] <- R2_second\n}\n```\n:::\n\n\n### MINERVA-AL discrepancy encoding (L = 1.0)\n\nLet's visualize the progression of ITS encoding by visualizing the semantic vector similarities. First, let's examine the similarities when the sentences are in the original order.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncosines_list_AL <- list()\nenvironment_sub <- no_overlap_riv(10000, length(dictionary_words))\n  \nits_memory_AL <- prior_memory_test\n\nfor(j in 1:max_sent_freq){\n    for(k in 1:length(sentence_ids)) {\n    current_sentence <- colSums(environment_sub[sentence_ids[[k]],])\n    echo <- colSums(as.numeric(cosine_x_to_m(current_sentence, its_memory_AL) ^ 3) * (its_memory_AL))\n    echo_norm <- echo/max(abs(echo))\n    its_memory_AL <- rbind(its_memory_AL, (current_sentence - echo_norm))\n    }\n  semantic_vectors <- subset_semantic_vectors(words_to_plot,\n                                                dictionary_words,\n                                                environment_sub,\n                                                its_memory_AL,\n                                                tau=3)\n  cosines_list_AL[[j]] <- lsa::cosine(t(semantic_vectors))\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(i in 1:length(cosines_list_AL)){\n  corrplot::corrplot(cosines_list_AL[[i]],\n                   method=\"circle\",\n                   order=\"original\",\n                   tl.col=\"black\",\n                   tl.cex=.4,\n                   title=\"\",\n                   cl.cex=.5,\n                   outline=FALSE,\n                   addgrid.col=NA)\n}\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-6.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-8.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-9.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-10.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-11.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-12.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-13.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-14.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-15.png){width=672}\n:::\n:::\n\n\nNow let's see the similairities when the sentences are randomly reordered every time they are presented.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncosines_list_AL <- list()\nenvironment_sub <- no_overlap_riv(10000, length(dictionary_words))\n  \nits_memory_AL <- prior_memory_test\n\nfor(j in 1:max_sent_freq){\n    sentence_ids_reordered <- sample(sentence_ids)\n    for(k in 1:length(sentence_ids_reordered)) {\n    current_sentence <- colSums(environment_sub[sentence_ids_reordered[[k]],])\n    echo <- colSums(as.numeric(cosine_x_to_m(current_sentence, its_memory_AL) ^ 3) * (its_memory_AL))\n    echo_norm <- echo/max(abs(echo))\n    its_memory_AL <- rbind(its_memory_AL, (current_sentence - echo_norm))\n    }\n  semantic_vectors <- subset_semantic_vectors(words_to_plot,\n                                                dictionary_words,\n                                                environment_sub,\n                                                its_memory_AL,\n                                                tau=3)\n  cosines_list_AL[[j]] <- lsa::cosine(t(semantic_vectors))\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(i in 1:length(cosines_list_AL)){\n  corrplot::corrplot(cosines_list_AL[[i]],\n                   method=\"circle\",\n                   order=\"original\",\n                   tl.col=\"black\",\n                   tl.cex=.4,\n                   title=\"\",\n                   cl.cex=.5,\n                   outline=FALSE,\n                   addgrid.col=NA)\n}\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-6.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-8.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-9.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-10.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-11.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-12.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-13.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-14.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-15.png){width=672}\n:::\n:::\n\n\nThe red lines are visible from the first iteration and get clearer with increasing sentence frequency. The red lines are also well-defined and sharp, instead of fading out. Each semantic vector has 2 semantic vectors it is negatively related to: one that is 10 words before it, and one that is 10 words after it.\n\nConversely, the blue areas disappear with increasing sentence frequency.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nR2_first_AL <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\nR2_second_AL <- matrix(0, nrow = n_of_sim, ncol = max_sent_freq)\n\nfor(i in 1:n_of_sim){\nenvironment_sub <- no_overlap_riv(10000, length(dictionary_words))\n\nR2_first <- numeric(length = max_sent_freq)\nR2_second <- numeric(length = max_sent_freq)\nprior_memory <- t(replicate(4, sample(c(-1,0,1), ncol(environment_sub), replace = TRUE)))\nits_memory_AL <- prior_memory\n\n  for(j in 1:max_sent_freq){\n    sentence_ids_reordered <- sample(sentence_ids)\n    for(k in 1:length(sentence_ids_reordered)) {\n    current_sentence <- colSums(environment_sub[sentence_ids_reordered[[k]],])\n    echo <- colSums(as.numeric(cosine_x_to_m(current_sentence, its_memory_AL) ^ 3) * (its_memory_AL))\n    echo_norm <- echo/max(abs(echo))\n    its_memory_AL <- rbind(its_memory_AL, (current_sentence - echo_norm))\n    }\n  semantic_vectors <- subset_semantic_vectors(words_to_plot,\n                                                dictionary_words,\n                                                environment_sub,\n                                                its_memory_AL,\n                                                tau=3)\n  cosines_ITS_AL <- lsa::cosine(t(semantic_vectors))\n  R2_first[j] <- cor(c(cosines_ITS_AL),c(first_order_cosines))^2\n  R2_second[j] <- cor(c(cosines_ITS_AL),c(second_order_cosines))^2\n  }\nR2_first_AL[i, ] <- R2_first\nR2_second_AL[i, ] <- R2_second\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nits_memory_AL[5:15, 1:10]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            [,1]       [,2]          [,3]       [,4]        [,5]          [,6]\n [1,] -0.9902249  0.9800854 -0.0003644247  0.9898605 -0.98949605 -0.0003644247\n [2,]  0.4402279 -0.5601055 -0.0011720580 -0.4414000  0.29405939 -0.1496846828\n [3,] -0.2458039  0.2913891 -0.0021546664  0.2436492 -0.15429010  0.0850497574\n [4,] -0.5662020 -0.8753036 -0.0513691984  0.5148328  0.22528171  0.6373761491\n [5,]  0.1644472 -0.1948313  0.0013446452 -0.1631026  0.10331676 -0.0570965288\n [6,]  0.2983304  0.4602992  0.0264701174 -0.2718602 -0.11733617 -0.3362561811\n [7,] -0.2009083 -0.3092899 -0.0178145725  0.1830937  0.07884617  0.2263107228\n [8,]  0.2359800  0.7863179  0.0113788318 -0.2246012 -0.07577225 -0.2776157501\n [9,]  0.2968734  0.4610591  0.0271181377 -0.2697552 -0.11909441 -0.3346133487\n[10,] -0.2050133 -0.3120172 -0.0186364081  0.1863769  0.08268106  0.2317851188\n[11,] -0.2481009  0.3783321 -0.0186421934  0.2294587 -0.12803588  0.0641384690\n             [,7]         [,8]         [,9]       [,10]\n [1,] -0.99927115  0.009775096 -0.009775096 -0.99927115\n [2,]  0.02684121  0.564243427 -0.267218177 -0.27018404\n [3,] -0.01934576 -0.309353186  0.134944338  0.15506309\n [4,] -0.47610937 -0.676099614 -0.701391081  0.90138133\n [5,]  0.01314685  0.207052257 -0.090169909 -0.10373550\n [6,]  0.25209696  0.356019468  0.369433129 -0.47335564\n [7,] -0.16941213 -0.239992291 -0.248258300  0.31883846\n [8,]  0.64615219 -0.143935271  0.721924435  0.06816302\n [9,]  0.24998845  0.354380113  0.369082860 -0.47347452\n[10,] -0.16529149 -0.252870499 -0.247972555  0.33555156\n[11,]  0.10361814 -0.397215340  0.231654015  0.26917946\n```\n:::\n\n```{.r .cell-code}\nits_memory_AL[1629:1639, 1:10]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               [,1]          [,2]          [,3]          [,4]          [,5]\n [1,] -1.831357e-04 -2.587937e-04 -1.466227e-05  1.684734e-04  5.496726e-05\n [2,] -1.170945e-04  4.503610e-04 -8.844870e-06  1.082497e-04 -1.330029e-04\n [3,]  1.635854e-04 -7.034873e-05  4.268141e-06 -1.593172e-04  6.591712e-05\n [4,] -4.498586e-03 -4.966660e-03 -2.578279e-04  4.240759e-03  5.716913e-04\n [5,] -6.918627e-05  1.849695e-04  1.021687e-06  7.020796e-05 -7.342769e-05\n [6,]  7.356388e-03  3.588394e-04  2.603572e-04 -7.096031e-03  1.600905e-03\n [7,] -1.054416e-02  1.280725e-02 -3.664857e-05  1.050751e-02 -1.053483e-02\n [8,]  1.406941e-03  1.268226e-03  7.447526e-05 -1.332465e-03 -8.366476e-05\n [9,] -1.163823e-04 -1.102679e-04 -6.943088e-06  1.094392e-04 -1.286903e-05\n[10,]  2.844449e-04  2.871378e-04  1.689969e-05 -2.675452e-04  3.376992e-05\n[11,]  2.622802e-04  6.310231e-04  2.247922e-05 -2.398010e-04 -1.655860e-04\n               [,6]          [,7]          [,8]          [,9]         [,10]\n [1,]  1.941161e-04 -1.635215e-04 -1.990681e-04 -2.184887e-04  2.540354e-04\n [2,] -4.244302e-05  1.755103e-04 -2.413169e-04  3.085132e-04  1.083140e-04\n [3,] -8.486383e-05  6.575366e-05  1.784274e-04 -1.634640e-07 -1.125103e-04\n [4,]  4.296794e-03 -4.081105e-03 -4.456447e-03 -4.652796e-03  5.028139e-03\n [5,] -1.176352e-06  3.913579e-05 -1.081674e-04  1.125635e-04  3.473971e-05\n [6,] -4.974412e-03  3.821006e-03  8.249436e-03  2.220101e-03 -6.648531e-03\n [7,] -1.006151e-04 -8.299056e-03 -2.107838e-03  2.235771e-03 -8.426989e-03\n [8,] -1.267180e-03  1.175372e-03  1.424273e-03  1.259037e-03 -1.507938e-03\n [9,]  8.268400e-05 -1.429491e-04 -4.917414e-05 -1.300800e-04  3.630511e-05\n[10,] -1.999759e-04  3.715773e-04  9.594378e-05  3.378074e-04 -6.217386e-05\n[11,] -3.604285e-04  3.223303e-04  2.778992e-04  4.879163e-04 -4.434852e-04\n```\n:::\n:::\n\n\n### Plotting the graphs for comparison\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# R-squared wrt first-order similarity\n\nR2_first_no_de <- data.frame(l_value = c(1.0, 0.7, 0.5, 0.3), rbind(colMeans(R2_first_1.0), colMeans(R2_first_0.7), colMeans(R2_first_0.5), colMeans(R2_first_0.3)))\ncolnames(R2_first_no_de) <- c(\"l_value\", 1:max_sent_freq)\nR2_first_no_de <- R2_first_no_de %>% pivot_longer(-l_value, names_to = \"sent_freq\", values_to = \"R2_first_order\")\n\nR2_first_de <- data.frame(sent_freq = 1:max_sent_freq, colMeans(R2_first_AL))\ncolnames(R2_first_de) <- c(\"sent_freq\", \"R2_first_order\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + geom_line(data = R2_first_no_de, aes(x = factor(sent_freq, level = 1:15), y = R2_first_order, group = as.factor(l_value), color = as.factor(l_value))) + geom_line(data = R2_first_de, aes(x = factor(sent_freq, level = 1:15), y = R2_first_order, group = 1), linetype = \"dashed\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# R-squared wrt second-order similarity\n\nR2_second_no_de <- data.frame(l_value = c(1.0, 0.7, 0.5, 0.3), rbind(colMeans(R2_second_1.0), colMeans(R2_second_0.7), colMeans(R2_second_0.5), colMeans(R2_second_0.3)))\ncolnames(R2_second_no_de) <- c(\"l_value\", 1:max_sent_freq)\nR2_second_no_de <- R2_second_no_de %>% pivot_longer(-l_value, names_to = \"sent_freq\", values_to = \"R2_second_order\")\n\nR2_second_de <- data.frame(sent_freq = 1:max_sent_freq, colMeans(R2_second_AL))\ncolnames(R2_second_de) <- c(\"sent_freq\", \"R2_second_order\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + geom_line(data = R2_second_no_de, aes(x = factor(sent_freq, level = 1:15), y = R2_second_order, group = as.factor(l_value), color = as.factor(l_value))) + geom_line(data = R2_second_de, aes(x = factor(sent_freq, level = 1:15), y = R2_second_order, group = 1), linetype = \"dashed\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nThe discrepancy encoding is still hitting a ceiling early on before declining, never reaching the values for when there is no discrepancy encoding. This is the case for the R-squared with respect to both first- and second-order similarities.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}